<!DOCTYPE html>
<html>
    <head>
        <title>VIP launching workshop - <i>sharing models for multi-modality medical image simulation with VIP</i></title>
        <link rel="StyleSheet" href="../css/doc_main.css" type="text/css" />
    </head>
    <body>
        <h1>Hands-on: sharing models for multi-modality medical image simulation with VIP</h1>
        This hands-on introduces the main semantic features in VIP, namely the model repository and the simulated data repository. 
        <br>Four exercises will allow you to experiment all the aspects of the creation and the use of models.
        <br>We will exemplify them on brain MRI simulation.
        <br><a name="contents"></a>
        Contents:
        <ul><li><a href="#ex1">Exercise 1:</a> explore the model repository (10 min)</li>
            <li><a href="#ex2">Exercise 2:</a> explore repository of simulated data (5 min)</li>
            <li><a href="#ex3">Exercise 3:</a> import your own model (15 min)</li>
            <li><a href="#ex4">Exercise 4:</a> launch simulations from model repository (10 min)</li>
             <li><a href="#ref">References and acknowledgments</a></li>
        </ul>
        <h2><a name="ex1">Exercise 1</a>: explore the model repository (10 min)</h2>

        <p><ul><li>In your home page, <span style="font-weight:bold; background-color:#e3e3ff;">open</span> the model repository in <b>Models</b>:</li></ul>
        <img alt="home_models" src="workshop/home.png"/>
        <ul>   
            <li>A list of models appears, containing in particular:
                <ol>
                    <li><a href="http://www.sciencedirect.com/science/article/pii/S1297956205000884">Adam</a>, a thorax model</li>
                    <li><a href="http://noodle.med.yale.edu/zubal">Zubal</a>, a full-body model</li>
                    <li><a href="http://ieeexplore.ieee.org/xpl/login.jsp?tp=&arnumber=712135&url=http%3A%2F%2Fieeexplore.ieee.org%2Fxpls%2Fabs_all.jsp%3Farnumber%3D712135">Brainweb</a>, a brain model with different degrees of multiple-sclerosis:
                        <ol><li><a href="http://brainweb.bic.mni.mcgill.ca/brainweb/anatomic_normal_20.html">Normal</a> (no lesion, subject 04)</li><li><a href="http://brainweb.bic.mni.mcgill.ca/brainweb/anatomic_ms1.html">Mild</a></li><li><a href="http://brainweb.bic.mni.mcgill.ca/brainweb/anatomic_ms.html">Moderate</a></li><li><a href="http://brainweb.bic.mni.mcgill.ca/brainweb/anatomic_ms3.html">Severe</a></li></ol></li>
                    <li>A <a href="http://link.springer.com/chapter/10.1007%2F978-3-642-33530-3_18?LI=true">brain model developed at IRISA</a></li>
                    <li>A <a href="http://www.ircad.fr/softwares/3Dircadb/3Dircadb1/index.php">liver model</a> from IRCAD, with cyst and tumors</li>
                </ol>
            </li>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Open</span> panel "Search" and <span style="font-weight:bold; background-color:#e3e3ff;">search</span> for the models containing object "Skull":</li></ul>
    <img src="workshop/skull.png" alt="skull"/>
    <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> on "BrainWeb-Normal-with-T1-T2-PD-maps".<br>
             <img src="workshop/brainmap.png" alt="brain_with_maps"/><br></li>
            <li>The model has a single timepoint and instant, with 3 parameter maps defining the proton density, T1 and T2 values in every voxel of the model. It also has a list of anatomical objects describing the structures in the model. The toolbar on top of the panel shows that this model is ready for MRI simulation.</li>
        </ul>
    <img src="workshop/brainweb1.png" alt="brainweb 1"/> 
        <ul>
    <li>In the model repository, <span style="font-weight:bold; background-color:#e3e3ff;">click</span> on "BrainWeb-Severe-Multiple-Sclerosis-with-Maps". <br>
        <img src="workshop/brainscelerosismap.png" alt="brain_scelorisis_with_maps"/><br></li>
    <li>The model has a pathological layer containing a demyelination:</li>
        </ul>
        <img src="workshop/brainweb2.png" alt="brainweb2"/>
        <ul><li>With the "Download" button, you can download a model to inspect its files:</li></ul>
        <img src="workshop/download1.png" alt="download"/>
        <br/>
        <a href="#contents">Back to top</a>
        
        <h2><a name="ex2">Exercise 2:</a> explore repository of simulated data (5 min)</h2>
        <ul><li>In your home page, <span style="font-weight:bold; background-color:#e3e3ff;">open</span> the simulated data repository in application <b>Simulated data</b>:</li></ul>
        <img src="workshop/simulated-data.png" alt="home_data"/>
        <ul><li>Data are presented by modality, with their semantic type, list of parameters and model used to produce them.</li></ul>
        <img src="workshop/simulated-data-mr.png" alt="mr_data"/>

        <ul><li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> on a simulated data and <span style="font-weight:bold; background-color:#e3e3ff;">open</span> its model by choosing "View model" in the contextual menu. You can see the corresponding entry in the model repository.</li>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> on a simulated data and <span style="font-weight:bold; background-color:#e3e3ff;">open</span> its simulation by choosing "View simulation" in the contextual menu. You can see the corresponding simulation and download its results.</li>
        </ul>
        <a href="#contents">Back to top</a>
        
        <h2><a name="ex3">Exercise 3:</a> import your own model (15 min)</h2>
        In this exercise you will import a model composed of 4 parameter maps acquired in the <a href="https://www.irisa.fr/visages/">VISAGES</a> team at INRIA. This model will be used in an MRI simulation in the next exercise.
        <ul>
            <li>To start the procedure as if *you* produced the model, <span style="font-weight:bold; background-color:#e3e3ff;">download</span> the following model maps in your computer (right-click on the links and choose "Save link As"): <a href="workshop/T1.nii.gz">T1</a>, <a href="workshop/T2.nii.gz">T2</a>, <a href="workshop/T2s.nii.gz">T2 star</a> and <a href="workshop/M0.nii.gz">proton density</a></li>
            <li>In your home, <span style="font-weight:bold; background-color:#e3e3ff;">open</span> the model repository <img src="workshop/modelrepositoryicon.png" alt="model repository"/>.</li>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> on "New model":</li>
        </ul>
        <img src="workshop/new-model1.png" alt="new model"/>
        <ul>
            <li>A tab containing two panels appears. The left panel will contain your model files. The right panel will contain the current status of your annotated model:</li>
        </ul>
        <img src="workshop/panels.png" alt="panels"/>
        <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> on button "Add file" to upload map M0.nii.gz (proton density). <span style="font-weight:bold; background-color:#e3e3ff;">Repeat</span> the operation for T1.nii.gz, T2.nii.gz and T2s.nii.gz:
        </ul>
        <img src="workshop/maps.png" alt="maps"/>
        <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Drag</span> and <span style="font-weight:bold; background-color:#e3e3ff;">drop</span> the proton density map (M0.nii.gz) from the left to the right panel:</li>
        </ul>
        <img src="workshop/drag.png" alt="drag"/>
        <ul>
            <li>The annotation panel appears. <span style="font-weight:bold; background-color:#e3e3ff;">Select</span> file type "Map", physical parameter "protonDensity", and layer "All":</li>
        </ul>
        <img src="workshop/annotation.png" alt="annotation"/>
        <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Click</span> "OK". The map has been added to your model:</li>
        </ul>
        <img src="workshop/added.png" alt="added"/>
        <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Repeat</span> this operation to add the T1, T2 and T2* maps. Your model is now valid for MRI:</li>
        </ul>
        <img src="workshop/all-maps.png" alt="all-maps"/>
        <ul>
            <li>We will now annotate the model with anatomical terms. <span style="font-weight:bold; background-color:#e3e3ff;">Right-click</span> on "Instant" to add an anatomical layer.
                <span style="font-weight:bold; background-color:#e3e3ff;">Expand</span> this layer,</li></ul>
                <img src="workshop/expand.png" alt="expand"/>
                <ul>
                    <li>                <span style="font-weight:bold; background-color:#e3e3ff;">Right-click</span> on "Objects" and <span style="font-weight:bold; background-color:#e3e3ff;">select</span> "Add object". A panel appears where you can search for terms in the ontology:</li>
        </ul><img src="workshop/annotation1.png" alt="annotation"/>
        <ul>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Write</span> "Skull" in the search field and <span style="font-weight:bold; background-color:#e3e3ff;">click OK</span>.</li>
            <li><span style="font-weight:bold; background-color:#e3e3ff;">Right-click</span> on the model name to change your model's name (known bug: on firefox navigator, the new name is not redrawn but a confirmation message is displayed):</li>
        </ul>
        <img src="workshop/name.png" alt="name"/>
        <ul><li>And finally, <span style="font-weight:bold; background-color:#e3e3ff;">commit</span> the model to the repository:</li>
        </ul>
        <img src="workshop/commit.png" alt="commit"/>
        <ul>
            <li>Your model should now be visible in the model repository.</li>
        </ul>
        <a href="#contents">Back to top</a>
        <h2><a name="ex4">Exercise 4:</a> launch simulations from model repository (10 min)</h2>
        In this exercise, you will simulate MRIs using the SimuBloch simulator developed in the <a href="https://www.irisa.fr/visages/">VISAGES</a> team at INRIA. 
        <ul><li><span style="font-weight:bold; background-color:#e3e3ff;">Make</span> sure that WebGL is properly configured in your web browser by checking the <a href="https://www.khronos.org/registry/webgl/sdk/demos/google/shiny-teapot/index.html">Teapot test</a> (you should see a 3D teapot). 
                If you have problems, ask the chairman.</li>
            <li>In the model repository <img src="workshop/modelrepositoryicon.png" alt="model repository"/>, <span style="font-weight:bold; background-color:#e3e3ff;">select</span> your model and <span style="font-weight:bold; background-color:#e3e3ff;">choose</span> "Launch simulation from model" in the contextual menu (right-click):</li></ul>
        <img src="workshop/launch-1.png" alt="launch"/>
        <ul><li>A 3D scene appears, showing a blue cube representing the bounding box of your model, and a representation of an MRI scanner. MRI was automatically selected since the model has magnetic parameters. Controls allow you to translate and rotate the model as well as the scanner:</li></ul>
        <img src="workshop/3d.png" alt="3d"/>
        <ul><li><span style="font-weight:bold; background-color:#e3e3ff;">Select</span> a simulator among the available MR sequences:
                <ol>
                    <li>Spin Echo: SE</li>
                    <li>Gradient Echo: GRE</li>
                    <li>Inversion Recovery - Spin Echo: IR-SE</li>
                    <li>Inversion Recovery - Gradient Echo (MPRAGE): IR-GRE</li>
                    <li>Spoiled Gradient Echo (SPGR, FLASH, T1-FFE): SP-GRE</li>
                    <li>Coherent Gradient Echo (Partially Refocused (Rewound) Gradient Echo, FISP, GRASS, FFE, FAST): CoherentGRE</li>
                </ol>
                For instance, GRE:
            </li></ul>
        <img src="workshop/select-simulator.png" alt="simulator selection"/>
        <ul><li>A tab containing simulation parameters appears. Information about the model and its geometrical transformation w.r.t. the scanner is already filled in. Fill in the input parameters with plausible values, for instance TR=120, TE=8 and result directory="/vip/Home". You can also load an example for this MRI sequence from <img src="workshop/examples.png" alt="examples"/>:</li></ul>
        <img src="workshop/params.png" alt="params"/>

        <ul><li><span style="font-weight:bold; background-color:#e3e3ff;">Launch</span> the simulation, and monitor it with "Simulation Monitor": <img src="workshop/monitor-icon.png" alt="monitor"/></li>
            <li><b>Known bug:</b> if no simulation job is created after a few minutes, i.e. the "Jobs summary" tab in your simulation still has no job:
        </ul>
        <img src="workshop/bug1.png" alt="bug"/>
        <ul>
            <li>Then kill your simulation and relaunch it using the contextual menu in the simulation monitor: <img src="workshop/monitor-icon.png" alt="monitor"/>
        </ul>
        <img src="workshop/kill.png" alt="kill"/>
                <ul>
            <li>When the simulation is finished, <span style="font-weight:bold; background-color:#e3e3ff;">download</span> the resulting image (.nii.gz), and <span style="font-weight:bold; background-color:#e3e3ff;">open</span> it for visualization. If you don't have a .nii.gz viewer on your computer, you can use VV (<a href="http://www.creatis.insa-lyon.fr/rio/vv?action=AttachFile&do=get&target=vv-1.3-win64.zip">Windows</a>, <a href="http://www.creatis.insa-lyon.fr/rio/vv?action=AttachFile&do=get&target=vv-1.3-linux64.sh">Linux 64 bits</a>) or medInria (<a href="http://med.inria.fr/the-app/downloads">all platforms</a>).</li></ul>
        <img height="500" src="workshop/vv.png" alt="view"/>
        <ul><li>Your image should also appear in the repository of simulated data:
        <img src="workshop/simulated.png" alt="simulated-icon"/>
        </li></ul>
        That's it, we hope you enjoyed the hands-on.<br/>
        <a href="#contents">Back to top</a>
        
        <h2><a name="ref">References and acknowledgments:</a></h2>
        The <a href="http://www.creatis.insa-lyon.fr/vip">Virtual Imaging Platform</a> is a French project funded by <a href="http://www.agence-nationale-recherche.fr">ANR</a> under grant ANR-09-COSI-03.
        <ul>
            <li>About SimuBloch and the T1, and T2 maps used in the model: Fang Cao; Olivier Commowick; Elise Bannier; Jean-Christophe Ferr&eacute;; Gilles Edan; Christian Barillot, "MRI Estimation of T1 Relaxation Time Using a Constrained Optimization Algorithm", MBIA 2012, Oct 2012, Nice, France. pp. 203-214 (<a href="http://hal.inria.fr/inserm-00723849/en">pdf</a>)</li>
            <li>About OntoVIP's design: B. Gibaud, G. Forestier, H. Benoit-Cattin, F. Cervenansky, P. Clarysse, D. Friboulet, A. Gaignard, P. Hugonnard, C. Lartizien, H. Liebgott, et al., "OntoVIP: an ontology for the annotation of object models used for medical image simulation", IEEE International Conference on Healthcare Informatics, Imaging and Systems Biology (HISB), La Jolla, California, USA, 2012.</a></li>
            <li>About the VIP platform:  "A Virtual Imaging Platform for multi-modality medical image simulation", Tristan Glatard, Carole Lartizien, Bernard Gibaud, Rafael Ferreira da Silva, Germain Forestier, Fr&eacute;d&eacute;ric Cervenansky, Martino Alessandrini, Hugues Benoit-Cattin, Olivier Bernard, Sorina Camarasu-Pop, Nadia Cerezo, Patrick Clarysse, Alban Gaignard, Patrick Hugonnard, Herv&eacute; Liebgott, Simon Marache, Adrien Marion, Johan Montagnat, Joachim Tabary, and Denis Friboulet, IEEE Transactions on Medical Imaging, in press, 2012</li>
            <li>The 3D scene interface was developed by <a href="mailto:kevmoulin@wanadoo.fr">Kevin Moulin</a> using WebGL</li>
            <li><a href="http://brainweb.bic.mni.mcgill.ca/brainweb/">Brainweb</a> is from the McGill university in Montr&eacute;al</li>
            <li><a href="http://www.creatis.insa-lyon.fr/rio/vv">VV</a> is from CREATIS, <a href="http://med.inria.fr/">medInria</a> is from INRIA</li>
        </ul>
    </body>
</html>
